<html>
  <head>
    <title>User Management (LocalStorage Demo)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="p-4">
    <div class="container">
      <h2>User Management</h2>
      <button class="btn btn-primary mb-3" onclick="openModal()">
        Add User
      </button>

      <table class="table table-bordered" id="userTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Bootstrap Modal -->
    <div class="modal fade" id="userModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="userForm">
            <div class="modal-header">
              <h5 class="modal-title">User Form</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="userId" />
              <div class="mb-3">
                <label>Name</label>
                <input type="text" class="form-control" id="name" required />
              </div>
              <div class="mb-3">
                <label>Email</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="mb-3">
                <label>Phone</label>
                <input type="text" class="form-control" id="phone" />
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <h4>New Code</h4>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let userModal = new bootstrap.Modal(document.getElementById("userModal"));

      // Retrieve users from localStorage
      function getUsers() {
        return JSON.parse(localStorage.getItem("users")) || [];
      }

      // Save users to localStorage
      function saveUsers(users) {
        localStorage.setItem("users", JSON.stringify(users));
      }

      // Load users into table
      function loadUsers() {
        let users = getUsers();
        let rows = "";
        users.forEach((u) => {
          rows += `<tr>
            <td>${u.id}</td>
            <td>${u.name}</td>
            <td>${u.email}</td>
            <td>${u.phone || ""}</td>
            <td>
                <button class="btn btn-sm btn-warning" onclick="openModal(${
                  u.id
                })">Edit</button>
            </td>
        </tr>`;
        });
        $("#userTable tbody").html(rows);
      }

      // Open modal (empty for Add / prefilled for Edit)
      function openModal(id) {
        $("#userForm")[0].reset();
        $("#userId").val("");
        if (id) {
          let users = getUsers();
          let user = users.find((u) => u.id === id);
          if (user) {
            $("#userId").val(user.id);
            $("#name").val(user.name);
            $("#email").val(user.email);
            $("#phone").val(user.phone);
          }
        }
        userModal.show();
      }

      // Handle save form
      $("#userForm").submit(function (e) {
        e.preventDefault();
        let users = getUsers();
        let id = $("#userId").val();

        if (id) {
          // Update
          let index = users.findIndex((u) => u.id == id);
          if (index !== -1) {
            users[index].name = $("#name").val();
            users[index].email = $("#email").val();
            users[index].phone = $("#phone").val();
          }
        } else {
          // Add new
          let newUser = {
            id: users.length > 0 ? users[users.length - 1].id + 1 : 1,
            name: $("#name").val(),
            email: $("#email").val(),
            phone: $("#phone").val(),
          };
          users.push(newUser);
        }

        saveUsers(users);
        userModal.hide();
        loadUsers();
      });

      // Initial load
      $(document).ready(function () {
        loadUsers();
      });
    </script>
  </body>
</html>
